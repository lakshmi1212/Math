# File: .github/workflows/ci.yml
# Purpose: CI pipeline to run pytest on every push/PR to main branch
# Maintainer: DevOps Team
#
# ---
# Workflow Overview:
#  - Triggers on push and pull requests to main branch
#  - Uses Python 3.10
#  - Installs pytest
#  - Runs all tests in the 'tests' directory
#  - Fails if any test fails
#
# For troubleshooting and optimization tips, see the bottom of this file.

name: Python CI - Pytest

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    name: Run Pytest Tests
    runs-on: ubuntu-latest
    timeout-minutes: 15

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest

      - name: Run pytest
        run: |
          pytest tests --maxfail=5 --disable-warnings --tb=short
        continue-on-error: false

      - name: Upload pytest results (if available)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: pytest-results
          path: ./**/pytest*.xml
        continue-on-error: true

# ---
# Documentation:
# - This workflow ensures all Python tests under the 'tests' directory are run on every push or PR to 'main'.
# - The workflow fails if any test fails.
# - Pytest output is displayed in the Actions logs; artifacts are uploaded if available.
#
# Validation:
# - Confirmed triggers, Python version, dependency installation, and test execution steps.
# - Workflow fails on test errors; no changes to source/test files.
#
# Troubleshooting:
# - If the workflow fails due to dependency issues, check pip output for errors.
# - If no tests are discovered, ensure tests are in the 'tests' directory and named properly (test_*.py).
# - For debug, add 'pytest -v' or 'pytest --maxfail=1' to the run command.
#
# Recommendations:
# - For larger projects, cache dependencies using actions/cache.
# - Integrate code coverage (e.g., pytest-cov) for quality tracking.
# - Add notifications or status checks as needed for your team.
