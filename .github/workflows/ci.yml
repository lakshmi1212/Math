# -----------------------------------------------
# GitHub Actions CI Pipeline for Python/pytest
# Auto-generated by DevOps Agent
#
# This workflow ensures that all tests in the 'tests' directory
# are executed automatically on every push or pull request to the main branch.
#
# Key Features:
# - Triggers: Push & PR to main
# - Python 3.10 environment
# - Installs dependencies from requirements.txt (including pytest)
# - Runs all pytest test cases under 'tests/'
# - Fails the pipeline if any test fails
# - Provides detailed logs and error reporting
# - No source or test files are modified
# -----------------------------------------------

name: CI Pipeline

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    name: Run Pytest Suite
    runs-on: ubuntu-latest

    steps:
      # Checkout source code
      - name: Checkout repository
        uses: actions/checkout@v4

      # Set up Python 3.10
      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # Install dependencies (including pytest)
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      # Run pytest on all tests in the 'tests' directory
      - name: Run pytest
        run: |
          pytest tests --maxfail=5 --disable-warnings --tb=short

      # Upload pytest results as artifacts (for further investigation if needed)
      - name: Upload pytest results
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: pytest-results
          path: ./**/pytest*.xml
        continue-on-error: true

# -----------------------------------------------
# TROUBLESHOOTING GUIDE
#
# - If the job fails at 'Install dependencies':
#     Check requirements.txt for syntax or network issues.
# - If the job fails at 'Run pytest':
#     Review the log output for test failures or errors in your code/tests.
#     Download the 'pytest-results' artifact for detailed XML reports.
# - For environment issues (e.g., Python version):
#     Ensure that 'setup-python' uses the correct version (3.10).
#
# -----------------------------------------------
# OPTIMIZATION & SCALABILITY RECOMMENDATIONS
#
# - For larger test suites, consider using pytest-xdist for parallel test execution.
# - Cache dependencies to speed up builds (see actions/cache).
# - Integrate code coverage reporting (e.g., codecov) for quality metrics.
# - Add security scanning jobs (e.g., Bandit, Dependabot).
# -----------------------------------------------
