# GitHub Actions CI workflow for Math repository
# Purpose: Run pytest on all pushes and pull requests to main branch.
# Maintainer: DevOps Automation Agent
#
# ---
# This workflow will:
# 1. Trigger on push and pull request events targeting main.
# 2. Set up Python 3.10 on the runner.
# 3. Install pytest.
# 4. Run all tests in the tests directory.
# 5. Fail the pipeline if any test fails.
# 6. Generate a summary report in the Actions UI.
#
# Troubleshooting:
# - If the workflow fails at setup-python: Check version syntax and runner compatibility.
# - If pytest installation fails: Ensure requirements.txt is up to date or manually specify pytest in 'pip install'.
# - If no tests are found: Confirm the 'tests' directory exists and contains test_*.py files.
# - For detailed logs, expand the 'Run pytest' step in the Actions UI.
#
# Recommendations for optimization & scalability:
# - Cache dependencies for faster builds (see commented 'actions/cache' example).
# - Parallelize tests with pytest-xdist for large suites.
# - Integrate code coverage reporting (e.g., codecov) if desired.
# - Use matrix builds to test against multiple Python versions.
#
# ---

name: CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  test:
    name: Run Pytest
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      # Uncomment to cache dependencies for faster builds
      # - name: Cache pip
      #   uses: actions/cache@v3
      #   with:
      #     path: ~/.cache/pip
      #     key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
      #     restore-keys: |
      #       ${{ runner.os }}-pip-

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pytest

      - name: Run pytest
        run: pytest tests

    # Error handling: The job will fail if pytest exits with nonzero status.
    # All output and errors are captured in the Actions UI logs.
